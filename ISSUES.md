# プロジェクトの課題分析

このドキュメントは、プロジェクトの現状を分析し、確認された課題や改善点をまとめたものです。

---

## 1. アーキテクチャの刷新と残された課題

### 1.1. 現状
本拡張機能は、以前のバージョンで採用されていた **C#製ヘルパー実行ファイルへの依存を完全に撤廃**し、`@openai/codex-sdk` を直接利用するモダンなアーキテクチャに刷新されました。これにより、以下の課題が解決されています。

-   **Windows環境への依存:** Node.jsベースになったことで、クロスプラットフォーム対応が実現されました。
-   **メンテナンス性の問題:** TypeScriptに技術スタックが統一され、開発・保守の複雑さが軽減されました。
-   **不安定な出力解析:** SDKが提供するAPIを利用するため、特殊なマーカー文字列に依存する脆い解析処理が不要になりました。

### 1.2. 今後の課題
アーキテクチャの刷新は成功しましたが、それに伴う新たな課題や、以前から引き継がれている改善点が残っています。

---

## 2. 柔軟性に欠ける設定（ハードコードされた値）

### 2.1. 現状
AIモデルの指定やプロンプトの内容など、拡張機能の動作を決定する重要な設定の多くが、`src/extension.ts` 内に直接書き込まれて（ハードコードされて）おり、ユーザーによるカスタマイズができません。

### 2.2. 詳細
-   **AIモデル名:** `model` は `'gpt-5-codex'` に固定されています。ユーザーが異なるモデル（例: `gpt-4`など）を試したい場合、ソースコードの変更が必要です。
-   **AIへの指示（プロンプト）:** コミットメッセージ生成のためのプロンプトが、`buildPrompt` 関数内に文字列として埋め込まれています。ユーザーが独自のスタイルや言語でプロンプトを調整することはできません。
-   **コンテキストの切り詰め長:** `MAX_SECTION_LENGTH` が `3000` 文字に固定されています。より多くのコンテキストをAIに渡したい、あるいは逆に短くして処理を高速化したいといった調整ができません。

### 2.3. 改善案
VSCodeの `settings.json` を通じて、ユーザーが以下の項目を設定できるように機能を追加します。
-   `codex.model`: 使用するAIモデル名。（デフォルト: `'gpt-5-codex'`）
-   `codex.prompt.ja` / `codex.prompt.en`: 日本語および英語のプロンプトテンプレート。
-   `codex.maxSectionLength`: 各コンテキストセクションの最大文字数。

---

## 3. 不親切なエラー処理

### 3.1. 現状
`codex` SDKのAPI呼び出しに失敗した場合や、予期せぬエラーが発生した場合、その**エラーメッセージがそのままコミットメッセージ欄に書き込まれてしまいます**。

### 3.2. 詳細
これはユーザーにとって不親切なだけでなく、混乱を招く可能性があります。エラーは操作の結果ではなく、操作が失敗したことを示す通知であるべきです。

### 3.3. 改善案
`vscode.window.showErrorMessage` APIを利用し、**ユーザーに分かりやすいモーダルダイアログでエラーを通知**する方式に変更します。
-   エラーダイアログには、「AIからの応答がありませんでした。APIキーの設定やネットワーク接続を確認してください。」のように、考えられる原因と解決策を提示します。
-   エラー発生時は、コミットメッセージ欄を空にするか、元の状態を維持するようにします。

---

## 4. コンテキスト情報の不足

### 4.1. 現状
`collectGitContext` 関数は `git diff` や `git status` などの基本的な情報を収集しますが、AIがより質の高いコミットメッセージを生成するためには、さらに多くのコンテキストが役立つ可能性があります。

### 4.2. 改善案
収集する情報に、以下のような項目を追加することを検討します。
-   **関連するIssueやタスク:** ブランチ名から `JIRA-123` のようなチケット番号を抽出し、関連情報としてAIに提供する。
-   **コードの静的解析情報:** 変更されたファイルに対してLintや静的解析ツールを実行し、その結果をコンテキストに含めることで、修正の意図をAIがより深く理解できるようにする。（これは高度な機能）
-   **ユーザーによる追記:** コミットメッセージ生成前に、ユーザーが自由記述で補足情報を追加できる入力欄を設ける。

これらの課題に対処することで、本拡張機能はより柔軟で使いやすく、堅牢なツールへと進化することができます。
